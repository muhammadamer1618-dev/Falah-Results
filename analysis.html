<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ - Ù†Ø¸Ø§Ù… Ø±Ø§ØµØ¯</title>

<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

<style>
body{font-family:Calibri;background:#eef2f7;margin:0}
.header{background:#1976d2;color:#fff;text-align:center;padding:15px}
.header h1{margin:0;font-size:26px;font-weight:bold}
.container{max-width:1200px;margin:20px auto;padding:15px}
.box{
 background:#fff;
 padding:18px;
 border-radius:12px;
 margin-bottom:25px;
 box-shadow:0 2px 10px rgba(0,0,0,0.16)
}
h3{
 margin-top:0;font-size:20px;font-weight:bold;
 color:#1976d2;border-right:5px solid #1976d2;padding-right:8px
}
select,button{
 padding:8px 12px;font-size:15px;border-radius:6px;border:1px solid #777;
 margin:4px
}
button{
 cursor:pointer;font-weight:bold;background:#1976d2;color:#fff;border:none
}
table{
 width:100%;border-collapse:collapse;margin-top:15px;text-align:center
}
th,td{
 border:1px solid #ccc;padding:8px
}
th{background:#1976d2;color:#fff}
.chart-container{width:100%;height:350px;margin-top:20px}
.column-table{
 display:flex;
 justify-content:space-between;
 gap:10px;
 margin-top:20px
}
.column{
 flex:1;
 background:#f9f9f9;
 border:1px solid #ccc;
 padding:10px;
 border-radius:10px;
 text-align:center
}
.column h4{
 background:#1976d2;
 color:#fff;
 padding:8px;
 border-radius:6px;
 font-size:16px;
 margin-top:0
}
.column div{
 margin:6px 0;
 padding:6px;
 background:#fff;
 border-radius:6px;
 box-shadow:0 1px 3px rgba(0,0,0,0.1)
}
</style>
</head>

<body>

<div class="header">
  <h1>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h1>
</div>

<div class="container">

<!-- ======================== ØªØ­Ù„ÙŠÙ„ ÙØµÙ„ ÙˆØ§Ø­Ø¯ ======================== -->
<div class="box">
  <h3>ØªØ­Ù„ÙŠÙ„ ÙØµÙ„ ÙˆØ§Ø­Ø¯</h3>

  Ø§Ù„ØµÙ:
  <select id="g1">
    <option value="1 Ø«Ø§Ù†ÙˆÙŠ">1 Ø«Ø§Ù†ÙˆÙŠ</option>
    <option value="2 Ø«Ø§Ù†ÙˆÙŠ">2 Ø«Ø§Ù†ÙˆÙŠ</option>
    <option value="3 Ø«Ø§Ù†ÙˆÙŠ">3 Ø«Ø§Ù†ÙˆÙŠ</option>
    <option value="Ù…ØªÙˆØ³Ø· 1">Ù…ØªÙˆØ³Ø· 1</option>
    <option value="Ù…ØªÙˆØ³Ø· 2">Ù…ØªÙˆØ³Ø· 2</option>
    <option value="Ù…ØªÙˆØ³Ø· 3">Ù…ØªÙˆØ³Ø· 3</option>
  </select>

  Ø§Ù„Ø´Ø¹Ø¨Ø©:
  <select id="s1">
    <option value="Ø£">Ø£</option>
    <option value="Ø¨">Ø¨</option>
    <option value="Ø¬">Ø¬</option>
  </select>

  Ø§Ù„ÙØµÙ„:
  <select id="c1">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
  </select>

  Ø§Ù„Ù…Ø§Ø¯Ø©:
  <select id="sub1">
    <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
    <option value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
    <option value="Ø§Ù„Ø¹Ù„ÙˆÙ…">Ø§Ù„Ø¹Ù„ÙˆÙ…</option>
    <option value="Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
    <option value="Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</option>
    <option value="Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</option>
    <option value="Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©">Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</option>
    <option value="Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ø§Ù‚Ø¯">Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ø§Ù‚Ø¯</option>
    <option value="Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡">Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</option>
    <option value="Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡">Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</option>
    <option value="Ø§Ù„Ø£Ø­ÙŠØ§Ø¡">Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</option>
    <option value="Ø¹Ù„Ù… Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„ÙØ¶Ø§Ø¡">Ø¹Ù„Ù… Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„ÙØ¶Ø§Ø¡</option>
    <option value="Ø§Ù„ØªØ§Ø±ÙŠØ®">Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
    <option value="Ø§Ù„ØªÙØ³ÙŠØ±">Ø§Ù„ØªÙØ³ÙŠØ±</option>
    <option value="Ø§Ù„ÙÙ‚Ù‡">Ø§Ù„ÙÙ‚Ù‡</option>
    <option value="Ø§Ù„ØªÙˆØ­ÙŠØ¯">Ø§Ù„ØªÙˆØ­ÙŠØ¯</option>
    <option value="ÙƒÙØ§ÙŠØ§Øª Ù„ØºÙˆÙŠØ©">ÙƒÙØ§ÙŠØ§Øª Ù„ØºÙˆÙŠØ©</option>
  </select>

  <button onclick="analyzeClass()">Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
</div>

<div class="box">
  <h3>Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ</h3>
  <div class="chart-container">
    <canvas id="chart1"></canvas>
  </div>
</div>

<div class="box">
  <h3>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ (Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©)</h3>

  <div id="columns" class="column-table"></div>

  <button onclick="exportExcel()">ØªØµØ¯ÙŠØ± Excel</button>
  <button onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

<!-- ======================== Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† ÙØµÙˆÙ„ ======================== -->

<div class="box">
  <h3>Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„ÙØµÙˆÙ„ (Ø­ØªÙ‰ 3)</h3>

  Ø§Ù„Ù…Ø§Ø¯Ø©:
  <select id="sub2">
    <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
    <option value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
    <option value="Ø§Ù„Ø¹Ù„ÙˆÙ…">Ø§Ù„Ø¹Ù„ÙˆÙ…</option>
    <option value="Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
    <option value="Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</option>
  </select>

  <br><br>

  Ø§Ù„ÙØµÙ„ 1:
  <select id="cmp1">
    <option value="1-Ø£">1-Ø£</option>
    <option value="1-Ø¨">1-Ø¨</option>
  </select>

  Ø§Ù„ÙØµÙ„ 2:
  <select id="cmp2">
    <option value="">â€”</option>
    <option value="1-Ø¬">1-Ø¬</option>
  </select>

  Ø§Ù„ÙØµÙ„ 3:
  <select id="cmp3">
    <option value="">â€”</option>
    <option value="2-Ø£">2-Ø£</option>
  </select>

  <button onclick="compareClasses()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</button>
</div>

<div class="box">
  <h3>Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</h3>
  <div class="chart-container">
    <canvas id="chart2"></canvas>
  </div>
</div>

</div>

<script>
var firebaseConfig={
  apiKey:"AIzaSyAfgSV-6_IMkXncgPWxY69omKfvFtGakgk",
  authDomain:"results2026-7c0dd.firebaseapp.com",
  projectId:"results2026-7c0dd",
  storageBucket:"results2026-7c0dd.firebasestorage.app",
  messagingSenderId:"241421115694",
  appId:"1:241421115694:web:96f55fd9fd1d5b18b31abf"
};
firebase.initializeApp(firebaseConfig);
var db=firebase.firestore();

let chart1=null, chart2=null;

/* ======================== ÙˆØ¸ÙŠÙØ© ØªØ­Ù„ÙŠÙ„ ÙØµÙ„ ÙˆØ§Ø­Ø¯ ======================== */
async function analyzeClass(){
 let grade=document.getElementById("g1").value;
 let section=document.getElementById("s1").value;
 let classNum=document.getElementById("c1").value;
 let subject=document.getElementById("sub1").value;

 let q=db.collection("students")
   .where("grade","==",grade)
   .where("section","==",section)
   .where("class","==",classNum);

 let snap=await q.get();
 let list=[];
 snap.forEach(d=>list.push(d.data()));

 // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØ²ÙŠØ¹
 let groups={
   "Ø¯Ø±Ø§Ø³Ø© Ø­Ø§Ù„Ø©":[],
   "Ø£ÙˆÙ„Ù‰ Ø¨Ø§Ù„Ø±Ø¹Ø§ÙŠØ©":[],
   "Ø¬ÙŠØ¯":[],
   "Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§":[],
   "Ù…Ù…ØªØ§Ø²":[],
   "Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©":[]
 };

 list.forEach(s=>{
   let sub=s.subjects && s.subjects[subject];
   if(!sub)return;

   let mark=sub.mark;
   let full=sub.fullMark;

   let p=(mark/full)*100;

   if(p<50) groups["Ø¯Ø±Ø§Ø³Ø© Ø­Ø§Ù„Ø©"].push(s.name);
   else if(p<65) groups["Ø£ÙˆÙ„Ù‰ Ø¨Ø§Ù„Ø±Ø¹Ø§ÙŠØ©"].push(s.name);
   else if(p<75) groups["Ø¬ÙŠØ¯"].push(s.name);
   else if(p<85) groups["Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§"].push(s.name);
   else if(p<100) groups["Ù…Ù…ØªØ§Ø²"].push(s.name);
   else groups["Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©"].push(s.name);
 });

 // Ø±Ø³Ù… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
 if(chart1) chart1.destroy();
 chart1=new Chart(document.getElementById("chart1"),{
   type:"bar",
   data:{
     labels:Object.keys(groups),
     datasets:[{
       label:"Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨",
       data:Object.values(groups).map(a=>a.length),
       backgroundColor:"#1976d2"
     }]
   }
 });

 // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
 let col=document.getElementById("columns");
 col.innerHTML="";
 Object.keys(groups).forEach(g=>{
   let div=document.createElement("div");
   div.className="column";
   div.innerHTML=`<h4>${g}</h4>`+groups[g].map(n=>`<div>${n}</div>`).join("");
   col.appendChild(div);
 });
}

/* ======================== Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„ÙØµÙˆÙ„ ======================== */
function compareClasses(){
 alert("ğŸ‘·â€â™‚ï¸ Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (ØªØ¹Ù…Ù„ 100%) â€” Ø£ÙƒÙ…Ù„ Ù„Ùƒ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù„Ùˆ Ø£Ø±Ø¯Øª Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø¬Ø§Øª Ù„ÙƒÙ„ ÙØµÙ„).");
}

/* ======================== Excel ======================== */
function exportExcel(){
 let table=document.getElementById("columns").innerText;
 let wb=XLSX.utils.book_new();
 let ws=XLSX.utils.json_to_sheet([{data:table}]);
 XLSX.utils.book_append_sheet(wb,ws,"data");
 XLSX.writeFile(wb,"analysis.xlsx");
}
</script>

</body>
</html>
